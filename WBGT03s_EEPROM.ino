// WBGTデータをATtiny85のEEPROMに書き込む by @pado3 2020/10/05
// 一気に書くにはRAMが足りないので5分割
// 順に1を立ててスケッチを書き込み、実行することでEEPROMに書き込む
#include <EEPROM.h>
#define WRITE1 0  // WBGTデータ1/4を書き込む(85byte,   0- 84)
#define WRITE2 0  // WBGTデータ2/4を書き込む(85byte,  85-169)
#define WRITE3 0  // WBGTデータ3/4を書き込む(85byte, 170-254)
#define WRITE4 0  // WBGTデータ4/Eを書き込む(85byte, 255-339)
#define WRITE5 0  // メッセージを書き込む(24byte, 340-363)

#define CLEAR  0  // 初期値の255を書き込む(0-363)

#define LED 3     // LED @D3 (2.2k) = pin2

void setup() {
  int i;  // 文字列アドレス, 340-363
  //          012345678901234567890123
  String mes="WBGT use  indoor-C%DEBUG "; // 最後のスペースはゴミ対策
  String s=""; // read message
  
  // LED setup
  pinMode(LED, OUTPUT);
  digitalWrite(LED, HIGH);  // ON
  delay(1000);  // 安定するまで待つ
  digitalWrite(LED, LOW);   // OFF
  
  // 上から下:21-40°C, 左から右:5ステップで20-100%RH
  int t, h, w; // t=0:21deg, t=19:40deg, h=0:20%, h=16:100%
  if (WRITE1) {  // 書き込みは慎重に！
    int wbgt1[5][17] = {
      {15,15,16,16,17,17,18,19,19,20,20,21,21,22,23,23,24},
      {15,16,17,17,18,18,19,19,20,21,21,22,22,23,24,24,25},
      {16,17,17,18,19,19,20,20,21,22,22,23,23,24,25,25,26},
      {17,18,18,19,19,20,21,21,22,22,23,24,24,25,26,26,27},
      {18,18,19,20,20,21,22,22,23,23,24,25,25,26,27,27,28}
      /*,
      {18,19,20,20,21,22,22,23,24,24,25,26,26,27,28,28,29},
      {19,20,21,21,22,23,23,24,25,25,26,27,27,28,29,29,30},
      {20,21,21,22,23,23,24,25,25,26,27,28,28,29,30,30,31},
      {21,21,22,23,24,24,25,26,26,27,28,29,29,30,31,31,32},
      {21,22,23,24,24,25,26,27,27,28,29,29,30,31,32,32,33},
      {22,23,24,24,25,26,27,27,28,29,30,30,31,32,33,33,34},
      {23,24,25,25,26,27,28,28,29,30,31,31,32,33,34,34,35},
      {24,25,25,26,27,28,28,29,30,31,32,32,33,34,35,35,36},
      {25,25,26,27,28,29,29,30,31,32,33,33,34,35,36,37,37},
      {25,26,27,28,29,29,30,31,32,33,33,34,35,36,37,38,38},
      {26,27,28,29,29,30,31,32,33,34,34,35,36,37,38,39,39},
      {27,28,29,29,30,31,32,33,34,35,35,36,37,38,39,40,41},
      {28,28,29,30,31,32,33,34,35,35,36,37,38,39,40,41,42},
      {28,29,30,31,32,33,34,35,35,36,37,38,39,40,41,42,43},
      {29,30,31,32,33,34,35,35,36,37,38,39,40,41,42,43,44}
      */
    };
    for (t=0; t<5; t++) {
      for (h=0; h<17; h++) {
        EEPROM.write(t*17+h, wbgt1[t][h]);
        //delay(500);
      }
    }
  }
  if (WRITE2) {  // 書き込みは慎重に！
    int wbgt2[5][17] = {
      /*
      {15,15,16,16,17,17,18,19,19,20,20,21,21,22,23,23,24},
      {15,16,17,17,18,18,19,19,20,21,21,22,22,23,24,24,25},
      {16,17,17,18,19,19,20,20,21,22,22,23,23,24,25,25,26},
      {17,18,18,19,19,20,21,21,22,22,23,24,24,25,26,26,27},
      {18,18,19,20,20,21,22,22,23,23,24,25,25,26,27,27,28},
      */
      {18,19,20,20,21,22,22,23,24,24,25,26,26,27,28,28,29},
      {19,20,21,21,22,23,23,24,25,25,26,27,27,28,29,29,30},
      {20,21,21,22,23,23,24,25,25,26,27,28,28,29,30,30,31},
      {21,21,22,23,24,24,25,26,26,27,28,29,29,30,31,31,32},
      {21,22,23,24,24,25,26,27,27,28,29,29,30,31,32,32,33}
      /*,
      {22,23,24,24,25,26,27,27,28,29,30,30,31,32,33,33,34},
      {23,24,25,25,26,27,28,28,29,30,31,31,32,33,34,34,35},
      {24,25,25,26,27,28,28,29,30,31,32,32,33,34,35,35,36},
      {25,25,26,27,28,29,29,30,31,32,33,33,34,35,36,37,37},
      {25,26,27,28,29,29,30,31,32,33,33,34,35,36,37,38,38},
      {26,27,28,29,29,30,31,32,33,34,34,35,36,37,38,39,39},
      {27,28,29,29,30,31,32,33,34,35,35,36,37,38,39,40,41},
      {28,28,29,30,31,32,33,34,35,35,36,37,38,39,40,41,42},
      {28,29,30,31,32,33,34,35,35,36,37,38,39,40,41,42,43},
      {29,30,31,32,33,34,35,35,36,37,38,39,40,41,42,43,44}
      */
    };
    for (t=5; t<10; t++) {
      for (h=0; h<17; h++) {
        EEPROM.write(t*17+h, wbgt2[t-5][h]);
        //delay(500);
      }
    }
  }
  if (WRITE3) {  // 書き込みは慎重に！
    int wbgt3[5][17] = {
      /*
      {15,15,16,16,17,17,18,19,19,20,20,21,21,22,23,23,24},
      {15,16,17,17,18,18,19,19,20,21,21,22,22,23,24,24,25},
      {16,17,17,18,19,19,20,20,21,22,22,23,23,24,25,25,26},
      {17,18,18,19,19,20,21,21,22,22,23,24,24,25,26,26,27},
      {18,18,19,20,20,21,22,22,23,23,24,25,25,26,27,27,28},
      {18,19,20,20,21,22,22,23,24,24,25,26,26,27,28,28,29},
      {19,20,21,21,22,23,23,24,25,25,26,27,27,28,29,29,30},
      {20,21,21,22,23,23,24,25,25,26,27,28,28,29,30,30,31},
      {21,21,22,23,24,24,25,26,26,27,28,29,29,30,31,31,32},
      {21,22,23,24,24,25,26,27,27,28,29,29,30,31,32,32,33},
      */
      {22,23,24,24,25,26,27,27,28,29,30,30,31,32,33,33,34},
      {23,24,25,25,26,27,28,28,29,30,31,31,32,33,34,34,35},
      {24,25,25,26,27,28,28,29,30,31,32,32,33,34,35,35,36},
      {25,25,26,27,28,29,29,30,31,32,33,33,34,35,36,37,37},
      {25,26,27,28,29,29,30,31,32,33,33,34,35,36,37,38,38}
      /*,
      {26,27,28,29,29,30,31,32,33,34,34,35,36,37,38,39,39},
      {27,28,29,29,30,31,32,33,34,35,35,36,37,38,39,40,41},
      {28,28,29,30,31,32,33,34,35,35,36,37,38,39,40,41,42},
      {28,29,30,31,32,33,34,35,35,36,37,38,39,40,41,42,43},
      {29,30,31,32,33,34,35,35,36,37,38,39,40,41,42,43,44}
      */
    };
    for (t=10; t<15; t++) {
      for (h=0; h<17; h++) {
        EEPROM.write(t*17+h, wbgt3[t-10][h]);
        //delay(500);
      }
    }
  }
  if (WRITE4) {  // 書き込みは慎重に！
    int wbgt4[5][17] = {
      /*
      {15,15,16,16,17,17,18,19,19,20,20,21,21,22,23,23,24},
      {15,16,17,17,18,18,19,19,20,21,21,22,22,23,24,24,25},
      {16,17,17,18,19,19,20,20,21,22,22,23,23,24,25,25,26},
      {17,18,18,19,19,20,21,21,22,22,23,24,24,25,26,26,27},
      {18,18,19,20,20,21,22,22,23,23,24,25,25,26,27,27,28},
      {18,19,20,20,21,22,22,23,24,24,25,26,26,27,28,28,29},
      {19,20,21,21,22,23,23,24,25,25,26,27,27,28,29,29,30},
      {20,21,21,22,23,23,24,25,25,26,27,28,28,29,30,30,31},
      {21,21,22,23,24,24,25,26,26,27,28,29,29,30,31,31,32},
      {21,22,23,24,24,25,26,27,27,28,29,29,30,31,32,32,33},
      {22,23,24,24,25,26,27,27,28,29,30,30,31,32,33,33,34},
      {23,24,25,25,26,27,28,28,29,30,31,31,32,33,34,34,35},
      {24,25,25,26,27,28,28,29,30,31,32,32,33,34,35,35,36},
      {25,25,26,27,28,29,29,30,31,32,33,33,34,35,36,37,37},
      {25,26,27,28,29,29,30,31,32,33,33,34,35,36,37,38,38},
      */
      {26,27,28,29,29,30,31,32,33,34,34,35,36,37,38,39,39},
      {27,28,29,29,30,31,32,33,34,35,35,36,37,38,39,40,41},
      {28,28,29,30,31,32,33,34,35,35,36,37,38,39,40,41,42},
      {28,29,30,31,32,33,34,35,35,36,37,38,39,40,41,42,43},
      {29,30,31,32,33,34,35,35,36,37,38,39,40,41,42,43,44}
    };
    for (t=15; t<20; t++) {
      for (h=0; h<17; h++) {
        EEPROM.write(t*17+h, wbgt4[t-15][h]);
        //delay(500);
      }
    }
  }
  if (WRITE5) {
    for (i=340; i<=363; i++) {
      EEPROM.write(i, mes.charAt(i-340));
        //delay(500);
    }
  }
  if (CLEAR) {
    for (i=0; i<=363; i++) {
      EEPROM.write(i, 255);
      //delay(500);
    }
  }
}

void loop() {
  // finish signal
  digitalWrite(LED, HIGH);  // ON
  delay(100);
  digitalWrite(LED, LOW);   // OFF
  delay(100);
}

// end of program
